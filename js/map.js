document.addEventListener('DOMContentLoaded', function() {
    // 百度地图API功能
    var map = new BMap.Map("allmap");
    var point = new BMap.Point(113.367415, 23.164816);
    map.centerAndZoom(point);
    map.addControl(new BMap.NavigationControl());
    map.enableScrollWheelZoom();
    map.addControl(new BMap.NavigationControl());
    map.addControl(new BMap.ScaleControl());
    map.addControl(new BMap.OverviewMapControl());
    map.addControl(new BMap.MapTypeControl());
    map.addControl(new BMap.GeolocationControl());
    map.setCurrentCity("广州");
    (function setBound() {
        var b = new BMap.Bounds(new BMap.Point(113.337052, 24.308803), new BMap.Point(113.393836, 22.018036));
        try {
            BMapLib.AreaRestriction.setBounds(map, b);
        } catch (e) {
            alert(e);
        }
    });
    (function setStyle() {
        var styleJson = [{
            "featureType": "all",
            "elementType": "geometry",
            "stylers": {
                "hue": "#007fff",
                "saturation": 89
            }
        }, {
            "featureType": "water",
            "elementType": "all",
            "stylers": {
                "color": "#ffffff"
            }
        }];
        map.setMapStyle({
            styleJson: styleJson
        });
    }());

    function getBoundary(rs) {
        var bdary = new BMap.Boundary();
        var count = rs.boundaries.length; //行政区域的点有多少个
        var pointArray = [];
        for (var i = 0; i < count; i++) {
            var ply = new BMap.Polygon(rs.boundaries[i], {
                strokeWeight: rs.strokeWeights[i] || 1,
                strokeColor: rs.strokeColors[i] || 'rgba(0,0,0,0)',
                fillColor: rs.fillColors[i],
                fillOpacity: rs.fillOpacities[i] || 0.5,
                enableClicking: false
            }); //建立多边形覆盖物
            map.addOverlay(ply); //添加覆盖物
            pointArray = pointArray.concat(ply.getPath());
        }
        map.setViewport(pointArray); //调整视野
    }

    function addPoint() {
        var content = '<div style="margin:0;line-height:20px;padding:2px;">' + '<img src="./img/hcife.jpg" alt="HCIFE" style="float:right;zoom:1;overflow:hidden;width:100px;height:100px;margin-left:3px;"/>' + '地址：广州市天河区五山路483号华南农业大学大学生创业创新孵化基地<br/><br/>简介：伟大的HCIFE在这里！' + '</div>';
        //创建检索信息窗口对象
        var searchInfoWindow = new BMapLib.SearchInfoWindow(map, content, {
            title: "HCIFE", //标题
            width: 290, //宽度
            height: 105, //高度
            panel: "panel", //检索结果面板
            enableAutoPan: true, //自动平移
            searchTypes: [
                BMAPLIB_TAB_SEARCH, //周边检索
                BMAPLIB_TAB_TO_HERE, //到这里去
                BMAPLIB_TAB_FROM_HERE //从这里出发
            ]
        });
        var poi = new BMap.Point(113.363642, 23.169064);
        var marker = new BMap.Marker(poi); //创建marker对象
        marker.addEventListener("click", function(e) {
            searchInfoWindow.open(marker);
        });
        map.addOverlay(marker); //在地图中添加marker
    }

    function addLabel(name, coordinate) {
        var opts = {
            position: new BMap.Point(coordinate[0], coordinate[1]) // 指定文本标注所在的地理位置
        }
        var label = new BMap.Label(name, opts); // 创建文本标注对象
        label.setStyle({
            color: "white",
            fontSize: "16px",
            height: "20px",
            lineHeight: "20px",
            padding: "0 2px",
            fontFamily: "微软雅黑",
            border: "0px solid",
            borderRadius: "10px",
            backgroundColor: "#7F7DC8"
        });
        var content = '<div style="margin:0;line-height:20px;padding:2px;">' + '<img src="" alt="' + name + '" style="float:right;zoom:1;overflow:hidden;width:100px;height:100px;margin-left:3px;"/>' + '地址：广州市天河区五山路483号华南农业大学<br/><br/>简介：华南农业大学' + name + '</div>';
        //创建检索信息窗口对象
        var searchInfoWindow = new BMapLib.SearchInfoWindow(map, content, {
            title: name, //标题
            width: 290, //宽度
            height: 105, //高度
            panel: "panel", //检索结果面板
            enableAutoPan: true, //自动平移
            searchTypes: [
                BMAPLIB_TAB_SEARCH, //周边检索
                BMAPLIB_TAB_TO_HERE, //到这里去
                BMAPLIB_TAB_FROM_HERE //从这里出发
            ]
        });
        label.addEventListener("click", function(e) {
            searchInfoWindow.open(opts.position);
        });
        map.addOverlay(label);
    }
    var coor = {
        boundaries: [],
        strokeColors: ['#FFDE66'],
        fillColors: ['', '#FC8DC5', '#817FD1', '#0e8469', '#FFE96A', '#6afcfa', '#ffffff', '#ff0000', '#8e1515', '#aa22a1'],
        fillOpacities: [0],
        strokeWeights: [5]
    };
    var scau = '113.353222,23.167997;113.356222,23.168462;113.357426,23.167316;113.358333,23.167197;113.359339,23.168086;113.359384,23.168811;113.358755,23.170871;113.358737,23.17107;113.360713,23.170339;113.36221,23.169952;113.365354,23.169603;113.367312,23.168872;113.367707,23.167128;113.367671,23.16623;113.368426,23.166247;113.36913,23.16526;113.370898,23.165783;113.371069,23.169924;113.370624,23.170048;113.370557,23.172316;113.370822,23.172179;113.371796,23.172096;113.373622,23.172457;113.373371,23.17318;113.37453,23.173421;113.380207,23.168238;113.379551,23.166709;113.381133,23.165667;113.379713,23.16374;113.377198,23.165895;113.375931,23.163428;113.374781,23.164002;113.374224,23.164151;113.372751,23.165563;113.371592,23.165575;113.370862,23.164454;113.370844,23.165451;113.369984,23.165069;113.371008,23.162091;113.371574,23.16136;113.37302,23.160247;113.375823,23.159474;113.37859,23.160762;113.378608,23.160305;113.378401,23.159998;113.376209,23.159059;113.376204,23.157238;113.375872,23.156565;113.369173,23.158041;113.368169,23.157969;113.366665,23.153771;113.365519,23.15616;113.364675,23.156534;113.363786,23.156218;113.362447,23.156276;113.361737,23.155745;113.361405,23.156708;113.360866,23.15788;113.358495,23.157971;113.358189,23.160372;113.357956,23.160729;113.357381,23.16087;113.357093,23.160779;113.356419,23.16146;113.355782,23.161501;113.355665,23.162506;113.354326,23.162349;113.354273,23.162623;113.351919,23.162648;113.35182,23.162216;113.350814,23.162265;113.350796,23.162614;113.350985,23.164359;113.350832,23.164533;113.350311,23.164583;113.350293,23.164857;113.350527,23.164865;113.350949,23.16558;113.35103,23.166585;113.353347,23.166643;113.353204,23.167864';
    var chashan = '113.368169,23.157969;113.366665,23.153771;113.365519,23.15616;113.364675,23.156534;113.363786,23.156218;113.362447,23.156276;113.361737,23.155745;113.361405,23.156708;113.360866,23.15788;113.364217,23.157971;113.366876,23.157581';
    var taishan = '113.371008,23.162091;113.371574,23.16136;113.37302,23.160247;113.375823,23.159474;113.37859,23.160762;113.378608,23.160305;113.378401,23.159998;113.376209,23.159059;113.376204,23.157238;113.375872,23.156565;113.369173,23.158041';
    var qilin = '113.370898,23.165783;113.371069,23.169924;113.370624,23.170048;113.370557,23.172316;113.370822,23.172179;113.371796,23.172096;113.373622,23.172457;113.373371,23.17318;113.37453,23.173421;113.380207,23.168238;113.379551,23.166709;113.381133,23.165667;113.379713,23.16374;113.377198,23.165895;113.375931,23.163428;113.374781,23.164002;113.374224,23.164151;113.372751,23.165563;113.371592,23.165575;113.370862,23.164454;113.370844,23.165451';
    var huashan = '113.355665,23.162506;113.354326,23.162349;113.354273,23.162623;113.351919,23.162648;113.35182,23.162216;113.350814,23.162265;113.350796,23.162614;113.350985,23.164359;113.350832,23.164533;113.350311,23.164583;113.350293,23.164857;113.350527,23.164865;113.350949,23.16558;113.35103,23.166585;113.353347,23.166643;113.353204,23.167864;113.353222,23.167997;113.356222,23.168462;113.357426,23.167316;113.358333,23.167197;113.359339,23.168086;113.359146,23.167135;113.359159,23.165004;113.357336,23.165071;113.356779,23.165353;113.356123,23.165453;113.356195,23.164522;113.356662,23.164406;113.356779,23.162487';
    var liuyi = '113.359308,23.167886;113.359146,23.167135;113.359159,23.165004;113.359355,23.16494;113.360659,23.164896;113.361349,23.164923;113.362809,23.165492;113.36258,23.166019;113.362818,23.16692;113.362539,23.167477;113.362706,23.167917;113.3628,23.168055;113.3624,23.16793';
    var iron = '113.363051,23.168206;113.363563,23.167517;113.364848,23.166728;113.364453,23.166138;113.364529,23.165521;113.363954,23.165517;113.363191,23.165567;113.362809,23.165492;113.36258,23.166019;113.362818,23.16692;113.362539,23.167477;113.362706,23.167917;113.3628,23.168055';
    var wushan = '113.355665,23.162506;113.356779,23.162487;113.356662,23.164406;113.356195,23.164522;113.356123,23.165453;113.356779,23.165353;113.357336,23.165071;113.359159,23.165004;113.359355,23.16494;113.360659,23.164896;113.360947,23.163883;113.361,23.163534;113.361126,23.162487;113.361494,23.162429;113.361845,23.162255;113.362662,23.162088;113.363929,23.162155;113.365582,23.164414;113.366139,23.165295;113.366209,23.165351;113.366866,23.165569;113.368546,23.165004;113.369319,23.165012;113.369615,23.164788;113.3701,23.163783;113.370154,23.163177;113.370037,23.162172;113.369813,23.16149;113.368169,23.157969;113.366876,23.157581;113.364217,23.157971;113.360866,23.15788;113.358495,23.157971;113.358189,23.160372;113.357956,23.160729;113.357381,23.16087;113.357093,23.160779;113.356419,23.16146;113.355782,23.161501';
    var songshan = '113.366209,23.165351;113.365517,23.165737;113.365225,23.165779;113.364745,23.165542;113.364529,23.165521;113.363954,23.165517;113.363191,23.165567;113.362809,23.165492;113.361349,23.164923;113.360659,23.164896;113.360947,23.163883;113.361,23.163534;113.361126,23.162487;113.361494,23.162429;113.361845,23.162255;113.362662,23.162088;113.363929,23.162155;113.365582,23.164414;113.366139,23.165295';
    var yanshan = '113.3628,23.168055;113.3624,23.16793;113.359308,23.167886;113.359339,23.168086;113.359384,23.168811;113.358755,23.170871;113.358737,23.17107;113.360713,23.170339;113.36221,23.169952;113.365354,23.169603;113.367312,23.168872;113.367707,23.167128;113.367671,23.16623;113.368426,23.166247;113.36913,23.16526;113.369319,23.165012;113.368546,23.165004;113.366866,23.165569;113.366209,23.165351;113.365517,23.165737;113.365225,23.165779;113.364745,23.165542;113.364529,23.165521;113.364453,23.166138;113.364848,23.166728;113.363563,23.167517;113.363051,23.168206';
    coor.boundaries.push(scau);
    coor.boundaries.push(qilin);
    coor.boundaries.push(taishan);
    coor.boundaries.push(chashan);
    coor.boundaries.push(huashan);
    coor.boundaries.push(liuyi);
    coor.boundaries.push(iron);
    coor.boundaries.push(wushan);
    coor.boundaries.push(songshan);
    coor.boundaries.push(yanshan);
    getBoundary(coor);
    addLabel('泰山区', [113.37037, 23.160176]);
    addLabel('华山区', [113.353979, 23.167241]);
    addLabel('燕山区', [113.359925, 23.1696]);
    addLabel('嵩山区', [113.361273, 23.164616]);
    addLabel('五山区', [113.361412, 23.161846]);
    addLabel('茶山区', [113.361524, 23.157506]);
    addLabel('六一区', [113.359584, 23.167523]);
    addLabel('启林区', [113.374173, 23.169334]);
    addLabel('钢铁所', [113.362405, 23.167474]);
    addPoint();
});